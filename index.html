<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech Demo</title>
    <style>
        .slider-container {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Text-to-Speech デモ</h1>

    <label for="langSelect">言語:</label>
    <select id="langSelect">
        <option value="ja-JP" selected>日本語 (ja-JP)</option>
        <option value="en-US">英語 (en-US)</option>
    </select>

    <br><br>

    <label for="textInput">テキスト:</label>
    <input type="text" id="textInput" placeholder="ここにテキストを入力" value="こんにちは、これはテストです">

    <div class="slider-container">
        <label for="speedRange">速度 (Rate): <span id="speedValue">1.2</span></label>
        <input type="range" id="speedRange" min="0.1" max="3" step="0.1" value="1.2">
    </div>

    <div class="slider-container">
        <label for="pitchRange">音程 (Pitch): <span id="pitchValue">1.0</span></label>
        <input type="range" id="pitchRange" min="0.1" max="2" step="0.1" value="1.0">
    </div>

    <div class="slider-container">
        <label for="volumeRange">音量 (Volume): <span id="volumeValue">1.0</span></label>
        <input type="range" id="volumeRange" min="0" max="1" step="0.1" value="1.0">
    </div>

    <button id="speakButton">読み上げ</button>

    <script>
        let voices = [];

        function loadVoices() {
            voices = speechSynthesis.getVoices();
            console.log("利用可能な音声:", voices);
        }

        function playTextToSpeech({ text, lang, speed = 1, pitch = 1, volume = 1, voiceName }) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = speed;
            utterance.pitch = pitch;
            utterance.volume = volume;

            if (voices.length === 0) {
                voices = speechSynthesis.getVoices();
            }

            if (voiceName) {
                const selectedVoice = voices.find(voice => voice.name === voiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                } else {
                    console.warn(`指定された音声 "${voiceName}" が見つかりません。`);
                }
            }

            speechSynthesis.speak(utterance);
        }

        document.getElementById("speakButton").addEventListener("click", () => {
            const text = document.getElementById("textInput").value;
            const lang = document.getElementById("langSelect").value;
            const speed = parseFloat(document.getElementById("speedRange").value);
            const pitch = parseFloat(document.getElementById("pitchRange").value);
            const volume = parseFloat(document.getElementById("volumeRange").value);

            playTextToSpeech({
                text,
                lang,
                speed,
                pitch,
                volume
            });
        });

        // スライダーの値をリアルタイム更新
        document.getElementById("speedRange").addEventListener("input", (event) => {
            document.getElementById("speedValue").textContent = event.target.value;
        });

        document.getElementById("pitchRange").addEventListener("input", (event) => {
            document.getElementById("pitchValue").textContent = event.target.value;
        });

        document.getElementById("volumeRange").addEventListener("input", (event) => {
            document.getElementById("volumeValue").textContent = event.target.value;
        });

        // 音声リストが更新されたら取得
        speechSynthesis.onvoiceschanged = loadVoices;
        window.onload = loadVoices;
    </script>
</body>
</html>
